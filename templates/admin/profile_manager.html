{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Profile Settings - Admin Panel{% endblock %}
{% block page_title %}Profile Settings{% endblock %}

{% block content %}
<div style="max-width: 1000px;">
    <!-- Profile Form -->
    <form method="POST" enctype="multipart/form-data" id="profileForm">
        {% csrf_token %}
        
        <!-- Personal Information -->
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.5rem; font-weight: 600; font-family: 'Poppins', sans-serif; color: var(--admin-text-primary); margin-bottom: 1.5rem;">
                Personal Information
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <!-- Profile Image -->
                <div style="grid-column: span 2;">
                    <label class="admin-form-label">Profile Image</label>
                    
                    <div style="display: flex; gap: 2rem; align-items: center;">
                        <!-- Current Image -->
                        <div id="imagePreview" style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; border: 3px solid var(--admin-border-color); flex-shrink: 0;">
                            {% if profile.image %}
                            <img id="previewImg" src="{{ profile.image.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                            <div style="width: 100%; height: 100%; background: var(--admin-bg-primary); display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-person-circle" style="font-size: 4rem; color: var(--admin-text-muted);"></i>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Upload Controls -->
                        <div>
                            <label for="image" class="admin-btn-secondary" style="cursor: pointer; margin-bottom: 0.75rem;">
                                <i class="bi bi-upload mr-2"></i>
                                Upload New Image
                            </label>
                            <input type="file" 
                                   id="image" 
                                   name="image" 
                                   accept="image/*"
                                   style="display: none;"
                                   onchange="previewImage(event)">
                            <p style="font-size: 0.75rem; color: var(--admin-text-muted);">
                                Recommended: Square image, at least 400x400px
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Name -->
                <div>
                    <label class="admin-form-label" for="name">Full Name *</label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           class="admin-form-input"
                           value="{{ profile.name|default:'' }}"
                           placeholder="Your Name"
                           required>
                </div>
                
                <!-- Role -->
                <div>
                    <label class="admin-form-label" for="role">Professional Role *</label>
                    <input type="text" 
                           id="role" 
                           name="role" 
                           class="admin-form-input"
                           value="{{ profile.role|default:'' }}"
                           placeholder="e.g., MCA Student | Data Scientist"
                           required>
                </div>
                
                <!-- Email -->
                <div>
                    <label class="admin-form-label" for="email">Email Address *</label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           class="admin-form-input"
                           value="{{ profile.email|default:'' }}"
                           placeholder="your.email@example.com"
                           required>
                </div>
                
                <!-- Phone -->
                <div>
                    <label class="admin-form-label" for="phone">Phone Number</label>
                    <input type="tel" 
                           id="phone" 
                           name="phone" 
                           class="admin-form-input"
                           value="{{ profile.phone|default:'' }}"
                           placeholder="+91 1234567890">
                </div>
                
                <!-- Bio with QuillJS -->
                <div style="grid-column: span 2;">
                    <label class="admin-form-label">Bio / About Me *</label>

                    <!-- Quill Editor -->
                    <div id="quill-bio"></div>

                    <!-- Hidden input to store content -->
                    <input type="hidden" id="bio" name="bio" required>

                    <p style="font-size: 0.75rem; color: var(--admin-text-muted); margin-top: 0.5rem;">
                        Write a brief description about yourself and your expertise
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Social Links -->
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.5rem; font-weight: 600; font-family: 'Poppins', sans-serif; color: var(--admin-text-primary); margin-bottom: 1.5rem;">
                Social Links
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <!-- GitHub -->
                <div>
                    <label class="admin-form-label" for="github">
                        <i class="bi bi-github mr-1"></i>
                        GitHub Profile
                    </label>
                    <input type="url" 
                           id="github" 
                           name="github" 
                           class="admin-form-input"
                           value="{{ profile.github|default:'' }}"
                           placeholder="https://github.com/yourusername">
                </div>
                
                <!-- LinkedIn -->
                <div>
                    <label class="admin-form-label" for="linkedin">
                        <i class="bi bi-linkedin mr-1"></i>
                        LinkedIn Profile
                    </label>
                    <input type="url" 
                           id="linkedin" 
                           name="linkedin" 
                           class="admin-form-input"
                           value="{{ profile.linkedin|default:'' }}"
                           placeholder="https://linkedin.com/in/yourusername">
                </div>
                
                <!-- Twitter -->
                <div>
                    <label class="admin-form-label" for="twitter">
                        <i class="bi bi-twitter mr-1"></i>
                        Twitter Profile
                    </label>
                    <input type="url" 
                           id="twitter" 
                           name="twitter" 
                           class="admin-form-input"
                           value="{{ profile.twitter|default:'' }}"
                           placeholder="https://twitter.com/yourusername">
                </div>
            </div>
        </div>
        
        <!-- Resume -->
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.5rem; font-weight: 600; font-family: 'Poppins', sans-serif; color: var(--admin-text-primary); margin-bottom: 1.5rem;">
                Resume / CV
            </h2>
            
            {% if profile.resume %}
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--admin-bg-secondary); border: 1px solid var(--admin-border-color); border-radius: 0.5rem; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="bi bi-file-pdf" style="font-size: 2rem; color: var(--admin-accent-error);"></i>
                    <div>
                        <p style="font-weight: 500; color: var(--admin-text-primary);">Current Resume</p>
                        <p style="font-size: 0.75rem; color: var(--admin-text-muted);">
                            {{ profile.resume.name|slice:"8:" }}
                        </p>
                    </div>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <a href="{{ profile.resume.url }}" target="_blank" class="admin-btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        <i class="bi bi-download mr-1"></i>
                        Download
                    </a>
                    <button type="submit" name="remove_resume" value="1" class="admin-btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        <i class="bi bi-trash mr-1"></i>
                        Delete
                    </button>
                </div>
            </div>
            {% endif %}
            
            <label for="resume" class="admin-btn-secondary" style="cursor: pointer; display: inline-flex;">
                <i class="bi bi-upload mr-2"></i>
                Upload New Resume
            </label>
            <input type="file" 
                   id="resume" 
                   name="resume" 
                   accept=".pdf,.doc,.docx"
                   style="display: none;">
            <p style="font-size: 0.75rem; color: var(--admin-text-muted); margin-top: 0.5rem;">
                Accepted formats: PDF, DOC, DOCX (Max: 5MB)
            </p>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <a href="{% url 'admin_dashboard' %}" class="admin-btn-secondary">
                Cancel
            </a>
            <button type="submit" class="admin-btn-success">
                <i class="bi bi-check-lg mr-2"></i>
                Save Changes
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Initialize Quill Editor for Bio
    var quillBio = new Quill('#quill-bio', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link'],
                ['clean']
            ]
        },
        placeholder: 'Write about yourself, your expertise, and your goals...'
    });

    // Load existing bio content after Quill initializes
    {% if profile.bio %}
    quillBio.root.innerHTML = `{{ profile.bio|safe|escapejs }}`;
    {% endif %}

    // Form submission - save Quill content
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        // Get Quill content
        var content = quillBio.root.innerHTML;
        document.getElementById('bio').value = content;

        // Validate content
        if (quillBio.getText().trim().length === 0) {
            e.preventDefault();
            alert('Please add a bio/about section');
            return false;
        }
    });
    
    // Image Preview
    function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    }
    
    // Resume file name display
    document.getElementById('resume').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                e.target.value = '';
                return;
            }
            
            // You can add a preview element here if needed
            console.log('Resume selected:', file.name);
        }
    });
</script>
{% endblock %}
